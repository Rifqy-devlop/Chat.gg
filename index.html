<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat App</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b141a">

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#000;
    color:white;
}

.header{
    background:#111;
    padding:10px;
    display:flex;
    align-items:center;
}

.profile{
    display:flex;
    align-items:center;
    gap:10px;
    flex:1;
}

.profile img{
    width:40px;
    height:40px;
    border-radius:50%;
    object-fit:cover;
    cursor:pointer;
}

.name{
    font-weight:bold;
    cursor:pointer;
}

.menu-btn{
    font-size:22px;
    cursor:pointer;
    padding:5px 10px;
}

.menu{
    position:absolute;
    top:60px;
    right:10px;
    background:#1c1c1c;
    border-radius:10px;
    display:none;
    flex-direction:column;
    overflow:hidden;
    box-shadow:0 0 10px rgba(0,0,0,0.5);
}

.menu div{
    padding:10px 20px;
    cursor:pointer;
}

.menu div:hover{
    background:#333;
}

.chat{
    height:75vh;
    overflow-y:auto;
    padding:10px;
    display:flex;
    flex-direction:column;
}

.message{
    max-width:75%;
    padding:8px 10px;
    margin:5px 0;
    border-radius:12px;
    font-size:14px;
    word-wrap:break-word;
    cursor:pointer;
}

.selected{
    outline:2px solid #00aaff;
}

.left{
    align-self:flex-start;
    background:#1f1f1f;
}

.right{
    align-self:flex-end;
    background:#0066ff;
}

.time{
    font-size:10px;
    text-align:right;
    margin-top:3px;
    color:#a0d2ff;
}

.input-area{
    position:fixed;
    bottom:0;
    width:100%;
    display:flex;
    gap:5px;
    padding:8px;
    background:#111;
}

input[type=text]{
    flex:1;
    border-radius:20px;
    border:none;
    padding:8px 12px;
    background:#222;
    color:white;
    outline:none;
}

button{
    border:none;
    border-radius:20px;
    padding:8px 12px;
    cursor:pointer;
    background:#0066ff;
    color:white;
}
</style>
</head>
<body>

<div class="header">
    <div class="profile">
        <img id="profileImg" src="icon.png">
        <div class="name" id="chatName">Nama</div>
    </div>
    <div class="menu-btn" onclick="toggleMenu()">⋮</div>
</div>

<div class="menu" id="menu">
    <div onclick="enableSelect()">Pilih Pesan</div>
    <div onclick="editSelected()">Edit Pesan</div>
    <div onclick="deleteSelected()">Hapus Pesan</div>
    <div onclick="deleteAll()">Hapus Semua Pesan</div>
</div>

<div class="chat" id="chatBox"></div>

<div class="input-area">
    <button onclick="toggleSide()">↺</button>
    <input type="text" id="msgInput" placeholder="Ketik pesan">
    <button onclick="sendMsg()">➤</button>
</div>

<script>
let side="right";
let selectedIndex=null;
let selectMode=false;

function toggleMenu(){
    let menu=document.getElementById("menu");
    menu.style.display = menu.style.display==="flex"?"none":"flex";
}

function toggleSide(){
    side = side==="right"?"left":"right";
}

function getTime(){
    let d=new Date();
    return d.getHours().toString().padStart(2,'0')+":"+d.getMinutes().toString().padStart(2,'0');
}

function getData(){
    return JSON.parse(localStorage.getItem("chatData")||"[]");
}

function saveData(data){
    localStorage.setItem("chatData",JSON.stringify(data));
}

function render(){
    let chatBox=document.getElementById("chatBox");
    chatBox.innerHTML="";
    let data=getData();

    data.forEach((msg,i)=>{
        let div=document.createElement("div");
        div.className="message "+msg.side;

        div.onclick=function(){
            if(selectMode){
                selectedIndex=i;
                document.querySelectorAll(".message").forEach(m=>m.classList.remove("selected"));
                div.classList.add("selected");
            }
        };

        div.innerHTML=msg.content;

        let time=document.createElement("div");
        time.className="time";
        time.innerText=msg.time+" ";
        div.appendChild(time);

        chatBox.appendChild(div);
    });
}

function sendMsg(){
    let input=document.getElementById("msgInput");
    let text=input.value.trim();
    if(text==="") return;

    let data=getData();
    data.push({
        content:text,
        side:side,
        time:getTime()
    });

    saveData(data);
    input.value="";
    render();
}

function enableSelect(){
    selectMode=true;
    toggleMenu();
}

function deleteSelected(){
    if(selectedIndex===null) return;
    let data=getData();
    data.splice(selectedIndex,1);
    saveData(data);
    selectedIndex=null;
    selectMode=false;
    render();
    toggleMenu();
}

function editSelected(){
    if(selectedIndex===null) return;
    let data=getData();
    let text=prompt("Edit pesan:",data[selectedIndex].content);
    if(text){
        data[selectedIndex].content=text;
        saveData(data);
        render();
    }
    toggleMenu();
}

function deleteAll(){
    localStorage.removeItem("chatData");
    render();
    toggleMenu();
}

/* Nama & Foto */

document.getElementById("chatName").onclick=function(){
    let name=prompt("Ganti nama:",this.innerText);
    if(name){
        this.innerText=name;
        localStorage.setItem("chatName",name);
    }
};

window.onload=function(){
    render();
    if(localStorage.getItem("chatName")){
        document.getElementById("chatName").innerText=localStorage.getItem("chatName");
    }
};
</script>

</body>
</html>